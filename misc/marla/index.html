<!doctype html>
<html lang="en-US">
	<head>
		<title>Test Survey</title>
		<meta charset="UTF-8">
		<meta name="author" content="Craig Weidert">
		<meta name="description" content="A Test Javascript Survey for Marla">

		<link rel="stylesheet" type="text/css" href="styles/default.css" media="screen" />

		<script src="utils.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.min.js"></script>
	</head>
	<body>
		<div class="heading">Test Survey</div>
		<div id="surveyDiv"></div>
		<div id="resultsDiv"></div>
	</body>
	
	<script id="questionTemplate" type="text/template">
		<form onsubmit="evaluateSurvey(); return false;">
		{{#questions}}
		<div class="question">
		<div class="title">{{prompt}}</div>
		{{#options}}
		<span class="option"><input type="radio" name="{{prompt}}" value="{{option}}">{{option}}</span>
		{{/options}}
		</div>
		{{/questions}}
		<input type="submit" value="Determine my Color!">
		</form>
	</script>
	
	<script id="resultsTemplate" type="text/template">
		<form onsubmit="setupSurvey(); return false;"> 
		<div class="title">{{title}}</div>
		<div class="description">{{description}}</div>
		<input type="submit" value="Re-Take Survey!">
		</form>
	</script>
	
	<script>
		var dimensions;
		var questions;
		var results;
	
		$('document').ready(function () {
			setupSurvey();
		});

		function evaluateSurvey() {
			tallySurvey();
			var result = getResult();
			displayResults(result);
		}
		
		function tallySurvey() {
			for (var i in questions) {
				var prompt = questions[i].prompt;
				var options = questions[i].options;
				var selected = $("input[name='" + prompt + "']:checked").val();
				for (var j in options) {
					var option = options[j];
					if (selected === option.option) {
						var effect = option.effect;
						if (effect) {
							modifyValues(dimensions, effect);
						}
					}
				}
			}
		}
		
		function getResult() {
			normalize(dimensions);

			var closestResult = results[0];
			var minDist = distance(dimensions, results[0].coordinate);
			for (var i in results) {
				var result = results[i];
				var dist = distance(dimensions, result.coordinate);
				if (dist < minDist) {
					minDist = dist;
					closestResult = result;
				}
			}
			
			return closestResult;
		}
		
		function displayResults(result) {
			var template = $("#resultsTemplate").html();
			var html = Mustache.to_html(template, result);
			$("#resultsDiv").html(html);
			$("#surveyDiv").addClass("hide");
			$("#resultsDiv").removeClass("hide");
		}

		function setupSurvey() {
			$.getJSON("testSurvey.json", function(survey) {
				dimensions = survey["dimensions"];
				questions = survey["questions"];
				results = survey["results"];

				var template = $("#questionTemplate").html();
				var html = Mustache.to_html(template, survey);
				$("#surveyDiv").html(html);
				$("#surveyDiv").removeClass("hide");
				$("#resultsDiv").addClass("hide");
			});
		}
	</script>
</html>
		